# sageTSDB ç¤ºä¾‹ç¨‹åº

æœ¬ç›®å½•åŒ…å« sageTSDB çš„å„ç§ç¤ºä¾‹ç¨‹åºï¼Œå±•ç¤ºæ ¸å¿ƒåŠŸèƒ½å’Œ PECJ é›†æˆèƒ½åŠ›ã€‚

## ğŸ“š ç¤ºä¾‹ç¨‹åºåˆ—è¡¨

### åŸºç¡€åŠŸèƒ½ç¤ºä¾‹

#### 1. persistence_example
**åŠŸèƒ½**: æ•°æ®æŒä¹…åŒ–æ¼”ç¤º
- æ—¶åºæ•°æ®ä¿å­˜å’ŒåŠ è½½
- æ£€æŸ¥ç‚¹ï¼ˆCheckpointï¼‰ç®¡ç†
- å¢é‡å†™å…¥å’Œæ•°æ®æ¢å¤

**è¿è¡Œæ–¹å¼**:
```bash
cd build/examples
./persistence_example
```

#### 2. plugin_usage_example
**åŠŸèƒ½**: æ’ä»¶ç³»ç»Ÿä½¿ç”¨æ¼”ç¤º
- æ’ä»¶åŠ è½½å’Œåˆå§‹åŒ–
- æ•°æ®æµå¤„ç†
- èµ„æºç®¡ç†å’Œç›‘æ§

**è¿è¡Œæ–¹å¼**:
```bash
cd build/examples
./plugin_usage_example
```

#### 3. table_design_demo
**åŠŸèƒ½**: è¡¨è®¾è®¡å’ŒåŸºæœ¬æ“ä½œæ¼”ç¤º
- è¡¨çš„åˆ›å»ºå’Œç®¡ç†
- æ•°æ®æ’å…¥å’ŒæŸ¥è¯¢
- ç´¢å¼•ä½¿ç”¨

**è¿è¡Œæ–¹å¼**:
```bash
cd build/examples
./table_design_demo
```

#### 4. window_scheduler_demo
**åŠŸèƒ½**: çª—å£è°ƒåº¦å™¨æ¼”ç¤º
- æ»‘åŠ¨çª—å£å’Œæ»šåŠ¨çª—å£
- çª—å£è§¦å‘æœºåˆ¶
- çª—å£èšåˆæ“ä½œ

**è¿è¡Œæ–¹å¼**:
```bash
cd build/examples
./window_scheduler_demo
```

---

### PECJ é›†æˆç¤ºä¾‹

#### 5. pecj_replay_demo
**ç”¨é€”**: å±•ç¤ºåŸºç¡€çš„æµå¼ Join åŠŸèƒ½

**ç‰¹æ€§**:
- ä»çœŸå®æ•°æ®é›†åŠ è½½ S æµå’Œ R æµ
- æŒ‰åˆ°è¾¾æ—¶é—´é¡ºåºé‡æ”¾æ•°æ®
- å®æ—¶æ˜¾ç¤ºçª—å£è§¦å‘å’Œ Join ç»“æœ
- ç»Ÿè®¡ååé‡ã€å»¶è¿Ÿç­‰æ€§èƒ½æŒ‡æ ‡
- æ”¯æŒå¤šç§ PECJ ç®—å­ï¼ˆIMAã€MSWJã€SHJ ç­‰ï¼‰

**è¿è¡Œæ–¹å¼**:
```bash
cd build/examples
./pecj_replay_demo \
    --s-file ../../../PECJ/benchmark/datasets/sTuple.csv \
    --r-file ../../../PECJ/benchmark/datasets/rTuple.csv \
    --max-tuples 10000 \
    --operator IMA \
    --window-ms 1000
```

**å‘½ä»¤è¡Œå‚æ•°**:
- `--s-file`: S æµæ•°æ®æ–‡ä»¶è·¯å¾„
- `--r-file`: R æµæ•°æ®æ–‡ä»¶è·¯å¾„
- `--max-tuples`: æœ€å¤§å¤„ç†å…ƒç»„æ•°
- `--operator`: PECJ ç®—å­ç±»å‹ï¼ˆIMA/SHJ/MSWJï¼‰
- `--window-ms`: çª—å£é•¿åº¦ï¼ˆæ¯«ç§’ï¼‰
- `--threads`: çº¿ç¨‹æ•°

#### 6. integrated_demo
**ç”¨é€”**: å±•ç¤º PECJ + æ•…éšœæ£€æµ‹çš„å®Œæ•´æ•°æ®ç®¡é“

**ç‰¹æ€§**:
- åŒæ—¶è¿è¡Œ PECJ å’Œæ•…éšœæ£€æµ‹æ’ä»¶
- å®æ—¶æ£€æµ‹ Join ç»“æœä¸­çš„å¼‚å¸¸
- ç”Ÿæˆå‘Šè­¦æ—¥å¿—
- è¾“å‡ºå®Œæ•´çš„æ€§èƒ½æŠ¥å‘Šï¼ˆæ–‡æœ¬å’Œæ–‡ä»¶ï¼‰
- æ”¯æŒ Z-Score å’Œ VAE æ£€æµ‹æ–¹æ³•

**è¿è¡Œæ–¹å¼**:
```bash
cd build/examples
./integrated_demo \
    --s-file ../../../PECJ/benchmark/datasets/sTuple.csv \
    --r-file ../../../PECJ/benchmark/datasets/rTuple.csv \
    --max-tuples 10000 \
    --detection zscore \
    --threshold 3.0 \
    --output integrated_results.txt
```

**å‘½ä»¤è¡Œå‚æ•°**:
- `--detection`: æ£€æµ‹æ–¹æ³•ï¼ˆzscore/vaeï¼‰
- `--threshold`: å¼‚å¸¸æ£€æµ‹é˜ˆå€¼
- `--output`: è¾“å‡ºæŠ¥å‘Šæ–‡ä»¶è·¯å¾„

#### 7. performance_benchmark
**ç”¨é€”**: ç³»ç»Ÿæ€§èƒ½è¯„ä¼°å’Œå¯¹æ¯”

**ç‰¹æ€§**:
- æµ‹è¯•å¤šç§ PECJ ç®—å­ï¼ˆIMAã€SHJã€MSWJï¼‰
- è¯„ä¼°ä¸åŒæ•°æ®è§„æ¨¡çš„æ€§èƒ½
- å¯¹æ¯”ä¸åŒçº¿ç¨‹æ•°çš„æ•ˆæœ
- å¤šæ¬¡é‡å¤æµ‹è¯•å–å¹³å‡å€¼
- ç”Ÿæˆ CSV æ ¼å¼çš„ç»“æœæŠ¥å‘Š

**è¿è¡Œæ–¹å¼**:
```bash
cd build/examples
./performance_benchmark \
    --s-file ../../../PECJ/benchmark/datasets/sTuple.csv \
    --r-file ../../../PECJ/benchmark/datasets/rTuple.csv \
    --output benchmark_results.csv
```

#### 8. deep_integration_demo
**ç”¨é€”**: å±•ç¤º sageTSDB ä¸ PECJ æ·±åº¦èåˆæ¶æ„

**æ¶æ„ç‰¹ç‚¹**:
- æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨ sageTSDB è¡¨ä¸­ï¼ˆæ—  PECJ å†…éƒ¨ç¼“å†²åŒºï¼‰
- PECJ ä½œä¸ºæ— çŠ¶æ€çº¯è®¡ç®—å¼•æ“
- ResourceManager ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç³»ç»Ÿèµ„æº
- å®Œæ•´çš„æ•°æ®æ‘„å…¥â†’å­˜å‚¨â†’è®¡ç®—â†’æŸ¥è¯¢æµç¨‹

**è¿è¡Œæ–¹å¼**:
```bash
cd build/examples
./deep_integration_demo \
    --events-s 10000 \
    --events-r 10000 \
    --keys 100 \
    --ooo-ratio 0.2 \
    --threads 4
```

**å‘½ä»¤è¡Œå‚æ•°**:
- `--events-s`: Stream S äº‹ä»¶æ•°é‡
- `--events-r`: Stream R äº‹ä»¶æ•°é‡
- `--keys`: Key å–å€¼èŒƒå›´
- `--ooo-ratio`: ä¹±åºæ¯”ä¾‹ï¼ˆ0.0-1.0ï¼‰
- `--threads`: æœ€å¤§çº¿ç¨‹æ•°

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ 1: ä½¿ç”¨äº¤äº’å¼è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
cd /path/to/sageTSDB
./examples/run_demo.sh
```

### æ–¹å¼ 2: ç›´æ¥è¿è¡Œ
```bash
cd /path/to/sageTSDB/build

# åŸºç¡€æ¼”ç¤º
./examples/pecj_replay_demo --max-tuples 5000

# å®Œæ•´æ¼”ç¤º
./examples/integrated_demo --max-tuples 10000 --detection zscore

# æ€§èƒ½æµ‹è¯•
./examples/performance_benchmark
```

---

## ğŸ“Š PECJ æ•°æ®é›†è¯´æ˜

### æ•°æ®é›†æ ¼å¼
æ‰€æœ‰ PECJ æ•°æ®é›†éµå¾ªä»¥ä¸‹ CSV æ ¼å¼ï¼š
```csv
key,value,eventTime,arrivalTime
51209364,1,0,455000
86971226,1,0,455000
...
```

**å­—æ®µè¯´æ˜**:
- `key`: Join é”®ï¼ˆç”¨äºåŒ¹é… S æµå’Œ R æµï¼‰
- `value`: å…ƒç»„å€¼
- `eventTime`: äº‹ä»¶æ—¶é—´æˆ³ï¼ˆå¾®ç§’ï¼‰
- `arrivalTime`: åˆ°è¾¾æ—¶é—´æˆ³ï¼ˆå¾®ç§’ï¼Œç”¨äºæ¨¡æ‹Ÿä¹±åºï¼‰

### å¯ç”¨æ•°æ®é›†
ä½äº `PECJ/benchmark/datasets/`:
- **sTuple.csv / rTuple.csv**: é€šç”¨æµ‹è¯•æ•°æ®ï¼ˆ~60K / ~77K æ¡ï¼‰
- **stock/**: è‚¡ç¥¨äº¤æ˜“æ•°æ®ï¼ˆå¤šä¸ªå»¶è¿Ÿçº§åˆ«ï¼‰
- **retail/**: é›¶å”®äº¤æ˜“æ•°æ®
- **rovio/**: Rovio æ¸¸æˆæ•°æ®
- **logistics/**: ç‰©æµæ•°æ®

### è‡ªå®šä¹‰æ•°æ®é›†
å¯ä»¥ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†ï¼Œåªéœ€ç¡®ä¿ï¼š
1. éµå¾ªä¸Šè¿° CSV æ ¼å¼
2. åŒ…å«è¡¨å¤´è¡Œ
3. æ—¶é—´æˆ³å•ä½ä¸ºå¾®ç§’

---

## ğŸ¯ æ¨èæ¼”ç¤ºæµç¨‹

### åœºæ™¯ 1: å‘å®¢æˆ·å¿«é€Ÿå±•ç¤ºï¼ˆ5 åˆ†é’Ÿï¼‰
**ç›®æ ‡**: å±•ç¤ºç³»ç»Ÿèƒ½æ­£å¸¸å·¥ä½œ

```bash
./examples/pecj_replay_demo --max-tuples 5000
```

**æ¼”ç¤ºè¦ç‚¹**:
- æ•°æ®åŠ è½½é€Ÿåº¦
- å®æ—¶å¤„ç†è¿›åº¦
- æœ€ç»ˆç»Ÿè®¡æŠ¥å‘Šï¼ˆååé‡ã€å»¶è¿Ÿï¼‰

### åœºæ™¯ 2: å®Œæ•´åŠŸèƒ½æ¼”ç¤ºï¼ˆ10 åˆ†é’Ÿï¼‰
**ç›®æ ‡**: å±•ç¤ºä»æ•°æ®è¾“å…¥åˆ°å¼‚å¸¸æ£€æµ‹çš„ç«¯åˆ°ç«¯èƒ½åŠ›

```bash
./examples/integrated_demo --max-tuples 10000 --detection zscore --threshold 2.5
```

**æ¼”ç¤ºè¦ç‚¹**:
- åŒæ’ä»¶ååŒå·¥ä½œ
- å®æ—¶å‘Šè­¦è¾“å‡º
- æ£€æµ‹åˆ°çš„å¼‚å¸¸æ•°é‡å’Œæ¯”ä¾‹
- æŠ¥å‘Šæ–‡ä»¶ç”Ÿæˆ

### åœºæ™¯ 3: æ€§èƒ½å¯¹æ¯”ï¼ˆ15 åˆ†é’Ÿï¼‰
**ç›®æ ‡**: å±•ç¤ºä¸åŒç®—å­å’Œé…ç½®çš„æ€§èƒ½å·®å¼‚

```bash
./examples/performance_benchmark
```

**æ¼”ç¤ºè¦ç‚¹**:
- IMA vs SHJ vs MSWJ çš„æ€§èƒ½å¯¹æ¯”
- å¤šçº¿ç¨‹åŠ é€Ÿæ•ˆæœ
- æ•°æ®è§„æ¨¡å¯¹æ€§èƒ½çš„å½±å“
- CSV æŠ¥å‘Šå¯ç”¨äºè¿›ä¸€æ­¥åˆ†æ

### åœºæ™¯ 4: æ·±åº¦æ¶æ„å±•ç¤ºï¼ˆ15 åˆ†é’Ÿï¼‰
**ç›®æ ‡**: å±•ç¤ºæ•°æ®åº“ä¸­å¿ƒåŒ–è®¾è®¡

```bash
./examples/deep_integration_demo --events-s 10000 --events-r 10000
```

**æ¼”ç¤ºè¦ç‚¹**:
- æ•°æ®åº“ä¸­å¿ƒåŒ–æ¶æ„
- ç»Ÿä¸€èµ„æºç®¡ç†
- æ— çŠ¶æ€è®¡ç®—å¼•æ“
- å®Œæ•´æ•°æ®æµç®¡é“

---

## ğŸ”§ æ„å»ºç¤ºä¾‹

### å‰ç½®æ¡ä»¶
- C++17 ç¼–è¯‘å™¨ï¼ˆGCC 8+ï¼‰
- CMake 3.15+
- PECJ æºç ï¼ˆç”¨äº PECJ é›†æˆç¤ºä¾‹ï¼‰

### æ„å»ºæ­¥éª¤

```bash
# 1. è¿›å…¥ sageTSDB ç›®å½•
cd /path/to/sageTSDB

# 2. åˆ›å»º build ç›®å½•
mkdir -p build && cd build

# 3. é…ç½® CMake
# åŸºç¡€é…ç½®ï¼ˆä¸å« PECJï¼‰
cmake ..

# æˆ–è€…å¯ç”¨ PECJ é›†æˆ
cmake .. \
    -DSAGE_TSDB_ENABLE_PECJ=ON \
    -DPECJ_DIR=/path/to/PECJ

# æˆ–è€…å¯ç”¨ PECJ æ·±åº¦é›†æˆæ¨¡å¼
cmake .. \
    -DSAGE_TSDB_ENABLE_PECJ=ON \
    -DPECJ_MODE=INTEGRATED \
    -DPECJ_DIR=/path/to/PECJ

# 4. ç¼–è¯‘
make -j$(nproc)

# 5. æ‰€æœ‰ç¤ºä¾‹ç¨‹åºä½äº
ls build/examples/
```

---

## ğŸ“– ç¤ºä¾‹ç¨‹åºå¯¹æ¯”

| Demo | ç”¨é€” | æ—¶é—´ | ä¾èµ– PECJ | é€‚åˆåœºæ™¯ |
|------|------|------|-----------|---------|
| persistence_example | æŒä¹…åŒ–åŠŸèƒ½ | ~2 åˆ†é’Ÿ | âŒ | åŸºç¡€åŠŸèƒ½å­¦ä¹  |
| plugin_usage_example | æ’ä»¶ç³»ç»Ÿ | ~2 åˆ†é’Ÿ | âŒ | æ’ä»¶å¼€å‘å‚è€ƒ |
| table_design_demo | è¡¨æ“ä½œ | ~1 åˆ†é’Ÿ | âŒ | æ•°æ®åº“æ“ä½œå­¦ä¹  |
| window_scheduler_demo | çª—å£è°ƒåº¦ | ~2 åˆ†é’Ÿ | âŒ | çª—å£æœºåˆ¶å­¦ä¹  |
| pecj_replay_demo | æµ Join åŸºç¡€ | ~5 åˆ†é’Ÿ | âœ… | å¿«é€Ÿæ¼”ç¤º |
| integrated_demo | PECJ + æ•…éšœæ£€æµ‹ | ~10 åˆ†é’Ÿ | âœ… | å®Œæ•´åŠŸèƒ½å±•ç¤º |
| performance_benchmark | æ€§èƒ½è¯„ä¼° | 15-30 åˆ†é’Ÿ | âœ… | æŠ€æœ¯è¯„ä¼° |
| deep_integration_demo | æ·±åº¦æ¶æ„ | ~15 åˆ†é’Ÿ | âœ… | æ¶æ„å±•ç¤º |

---

## ğŸ” ç–‘éš¾è§£ç­”

### ç¼–è¯‘é”™è¯¯
- ç¡®ä¿å·²å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆè§æ ¹ç›®å½• README.mdï¼‰
- æ£€æŸ¥ CMake é…ç½®æ˜¯å¦æ­£ç¡®
- PECJ é›†æˆç¤ºä¾‹éœ€è¦æ­£ç¡®è®¾ç½® `PECJ_DIR`

### è¿è¡Œé”™è¯¯
- æ£€æŸ¥æ•°æ®æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
- ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆæŒä¹…åŒ–ç¤ºä¾‹ï¼‰
- æŸ¥çœ‹æ—¥å¿—è¾“å‡ºè·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### æ•°æ®é›†æ‰¾ä¸åˆ°
- ç¡®è®¤ PECJ æ•°æ®é›†è·¯å¾„ï¼š`PECJ/benchmark/datasets/`
- ä½¿ç”¨ `--s-file` å’Œ `--r-file` å‚æ•°æŒ‡å®šå®Œæ•´è·¯å¾„

---

## ğŸ“ é…ç½®æ–‡ä»¶

éƒ¨åˆ†ç¤ºä¾‹ä½¿ç”¨é…ç½®æ–‡ä»¶ `demo_configs.json` è¿›è¡Œå‚æ•°è®¾ç½®ã€‚æ‚¨å¯ä»¥ä¿®æ”¹æ­¤æ–‡ä»¶æ¥è°ƒæ•´ï¼š
- æ•°æ®è·¯å¾„
- èµ„æºé™åˆ¶
- ç®—æ³•å‚æ•°
- è¾“å‡ºè®¾ç½®

---

## ğŸ“ å­¦ä¹ è·¯å¾„

å¦‚æœæ‚¨æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ sageTSDBï¼Œå»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºå­¦ä¹ ç¤ºä¾‹ï¼š

1. **persistence_example** - äº†è§£åŸºæœ¬çš„æ•°æ®æ“ä½œ
2. **table_design_demo** - ç†è§£è¡¨ç»“æ„å’Œæ“ä½œ
3. **window_scheduler_demo** - å­¦ä¹ çª—å£æœºåˆ¶
4. **plugin_usage_example** - ç†è§£æ’ä»¶ç³»ç»Ÿ
5. **pecj_replay_demo** - å­¦ä¹ æµå¼ Join
6. **integrated_demo** - å­¦ä¹ å®Œæ•´é›†æˆ
7. **deep_integration_demo** - ç†è§£æ·±åº¦æ¶æ„
8. **performance_benchmark** - ä¼˜åŒ–æ€§èƒ½é…ç½®

---

## ğŸ“ æ›´å¤šä¿¡æ¯

- **å®Œæ•´æ–‡æ¡£**: å‚è§ `docs/` ç›®å½•
- **å•å…ƒæµ‹è¯•**: å‚è§ `tests/` ç›®å½•ä½œä¸º API ä½¿ç”¨å‚è€ƒ
- **æ„å»ºè„šæœ¬**: å‚è§ `scripts/` ç›®å½•
